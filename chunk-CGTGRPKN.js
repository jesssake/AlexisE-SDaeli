import{a as S}from"./chunk-SQW5QAAD.js";import{$ as b,$a as P,Ga as I,La as y,Oa as h,Tb as N,Ua as k,Va as m,Wa as r,Xa as o,Ya as v,_ as x,_b as D,ab as C,bb as p,fa as u,fc as A,ic as E,kb as s,lb as g,mb as w,wa as c}from"./chunk-SB32BB4B.js";function z(a,i){a&1&&(r(0,"div",9),v(1,"div",10),r(2,"div",11),v(3,"span",12)(4,"span",12)(5,"span",13),o()())}function V(a,i){if(a&1&&(r(0,"div",14),s(1),o()),a&2){let e=p();c(),w(" ",e.error()," ")}}function U(a,i){a&1&&(r(0,"div",15),s(1," No se encontr\xF3 tu tutor registrado. Pregunta a tu maestro para que lo vincule en el sistema. "),o())}function F(a,i){if(a&1&&(r(0,"div",27)(1,"span",21),s(2,"Correo"),o(),r(3,"span"),s(4),o()()),a&2){let e=p(2);c(4),g(e.tutorCorreo())}}function R(a,i){if(a&1){let e=P();r(0,"div",16)(1,"div",17)(2,"div",18)(3,"span"),s(4,"\u{1F468}\u200D\u{1F469}\u200D\u{1F467}"),o()(),r(5,"div",19)(6,"div",20)(7,"span",21),s(8,"Alumno"),o(),r(9,"strong"),s(10),o()(),r(11,"div",22)(12,"span",21),s(13,"Tutor"),o(),r(14,"strong"),s(15),o()(),h(16,F,5,1,"div",23),o()(),r(17,"div",24)(18,"button",25),C("click",function(){x(e);let l=p();return b(l.abrirChat())}),s(19," \u{1F4AC} Abrir chat con mi tutor "),o(),r(20,"p",26),s(21," Usa este chat s\xF3lo para temas escolares y con supervisi\xF3n de un adulto. "),o()()()}if(a&2){let e=p();c(10),g(e.alumnoNombre()||"Alumno"),c(5),g(e.tutorNombre()||"Sin tutor"),c(),m("ngIf",e.tutorCorreo())}}function H(a,i){if(a&1){let e=P();r(0,"aside",28)(1,"div",29)(2,"strong"),s(3),o(),r(4,"button",30),C("click",function(){x(e);let l=p();return b(l.cerrarChat())}),s(5," \u2715 "),o()(),r(6,"app-chat-panel",31),C("closed",function(){x(e);let l=p();return b(l.cerrarChat())}),o()()}if(a&2){let e=p();k("aria-label",e.tituloChat()),c(3),g(e.tituloChat()),c(3),m("alumnoId",e.alumnoId())("tutorId",e.tutorId())("titulo",e.tituloChat())("role","ALUMNO")("floating",!1)}}var T=class a{constructor(i){this.http=i}baseUrl="/api/chat/tutores_del_maestro.php";cargando=u(!1);error=u(null);alumnoId=u(null);alumnoNombre=u(null);tutorId=u(null);tutorNombre=u(null);tutorCorreo=u(null);chatAbierto=u(!1);tituloChat=u("Chat con mi tutor");ngOnInit(){let i=this.detectarAlumnoId();this.alumnoId.set(i||null),this.cargarDatosTutor(i??void 0)}detectarAlumnoId(){let i=["alumno_id","nino_id","id_nino","id_alumno","alumnoId","idAlumno"];for(let e of i){let n=localStorage.getItem(e);if(!n)continue;let l=Number(n);if(Number.isFinite(l)&&l>0)return console.log("[PadresAlumno] ID detectado desde localStorage:",e,l),l}try{let e=new URLSearchParams(window.location.search),n=["alumno_id","nino_id","id_alumno","idAlumno"];for(let l of n){let d=e.get(l);if(!d)continue;let f=Number(d);if(Number.isFinite(f)&&f>0)return console.log("[PadresAlumno] ID detectado desde URL:",l,f),f}}catch{}return console.warn("[PadresAlumno] No se detect\xF3 alumno_id ni en storage ni en URL"),null}cargarDatosTutor(i){this.cargando.set(!0),this.error.set(null),this.http.get(this.baseUrl).subscribe({next:e=>{let l=(e??[]).map(t=>{let _=t.alumno_id??t.nino_id??t.id_alumno??t.id??t.alumno;if(typeof _=="string"){let O=_.match(/\d+/);_=O?Number(O[0]):0}let M=t.tutor_id??t.id_tutor??t.tutorId??t.id_padre??null;return{alumno_id:Number(_||0),alumno_nombre:t.alumno_nombre??t.nino_nombre??t.alumno??t.nombre_alumno??t.nombre??null,tutor_id:M!=null?Number(M):null,tutor_nombre:t.tutor_nombre??t.tutor??t.nombre_tutor??t.padre??null,tutor_correo:t.tutor_correo??t.email_tutor??t.correo_tutor??t.email??null}});if(!l.length){this.error.set("No se encontraron alumnos/tutores registrados. Consulta con el maestro."),this.cargando.set(!1);return}let d=null;i&&i>0&&(d=l.find(t=>t.alumno_id===i)??null),d||(d=l[0],this.alumnoId.set(d.alumno_id),console.warn("[PadresAlumno] Usando primer alumno de la lista como fallback:",d)),this.alumnoNombre.set(d.alumno_nombre??"Alumno"),this.tutorId.set(d.tutor_id),this.tutorNombre.set(d.tutor_nombre),this.tutorCorreo.set(d.tutor_correo);let f="Chat: "+(d.alumno_nombre??"Alumno")+" \xB7 "+(d.tutor_nombre??"Tutor");this.tituloChat.set(f),this.cargando.set(!1)},error:e=>{console.error("tutores_del_maestro.php error (alumno):",e),this.error.set("No se pudo cargar la informaci\xF3n de tu tutor. Intenta m\xE1s tarde."),this.cargando.set(!1)}})}abrirChat(){if(!this.alumnoId()){alert("No se pudo determinar tu ID de alumno. Verifica con el administrador.");return}this.chatAbierto.set(!0)}cerrarChat(){this.chatAbierto.set(!1)}static \u0275fac=function(e){return new(e||a)(I(A))};static \u0275cmp=y({type:a,selectors:[["app-padres"]],decls:12,vars:5,consts:[["role","region","aria-label","Padres y chat del alumno",1,"layout"],[1,"info"],[1,"info-head"],[1,"muted"],["class","skeleton",4,"ngIf"],["class","state error",4,"ngIf"],["class","state",4,"ngIf"],["class","card",4,"ngIf"],["class","panel","role","dialog","aria-modal","true",4,"ngIf"],[1,"skeleton"],[1,"avatar","sk"],[1,"lines"],[1,"sk","line"],[1,"sk","line","short"],[1,"state","error"],[1,"state"],[1,"card"],[1,"card-main"],[1,"avatar"],[1,"data"],[1,"alumno"],[1,"label"],[1,"tutor"],["class","correo",4,"ngIf"],[1,"card-actions"],["type","button",1,"btn-chat",3,"click"],[1,"hint"],[1,"correo"],["role","dialog","aria-modal","true",1,"panel"],[1,"panel-head"],["type","button","aria-label","Cerrar chat",1,"btn-cerrar",3,"click"],[3,"closed","alumnoId","tutorId","titulo","role","floating"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"section",1)(2,"header",2)(3,"h1"),s(4,"Mis padres / tutor"),o(),r(5,"p",3),s(6," Aqu\xED puedes ver los datos de tu tutor y chatear con \xE9l cuando lo autoricen. "),o()(),h(7,z,6,0,"div",4)(8,V,2,1,"div",5)(9,U,2,0,"div",6)(10,R,22,3,"div",7),o(),h(11,H,7,7,"aside",8),o()),e&2&&(c(7),m("ngIf",n.cargando()),c(),m("ngIf",!n.cargando()&&n.error()),c(),m("ngIf",!n.cargando()&&!n.error()&&!n.tutorNombre()&&!n.tutorCorreo()),c(),m("ngIf",!n.cargando()&&!n.error()&&(n.tutorNombre()||n.tutorCorreo())),c(),m("ngIf",n.chatAbierto()&&n.alumnoId()))},dependencies:[D,N,E,S],styles:["[_nghost-%COMP%]{display:block;min-height:100dvh}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:minmax(0,1.4fr) minmax(0,1.6fr);gap:24px;padding:24px;background:radial-gradient(900px 480px at 10% 0%,#eef4ff,transparent 60%),radial-gradient(900px 520px at 90% 100%,#fde7ff,transparent 60%),linear-gradient(180deg,#f6f7ff,#eef3ff 40%,#f8f1ff)}@media (max-width: 1024px){.layout[_ngcontent-%COMP%]{grid-template-columns:minmax(0,1fr);grid-template-rows:auto auto}}.info[_ngcontent-%COMP%]{align-self:start;background:#fff;border-radius:22px;padding:24px 24px 20px;box-shadow:0 22px 55px #0f172a14,0 2px 10px #0f172a0a}.info-head[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.35rem;font-weight:700;margin:0 0 4px;color:#1f2933}.info-head[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#6b7280}.skeleton[_ngcontent-%COMP%]{margin-top:20px;display:flex;align-items:center;gap:16px}.skeleton[_ngcontent-%COMP%]   .avatar.sk[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:18px;background:linear-gradient(90deg,#eef1ff,#f5f0ff,#eef1ff);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.3s linear infinite}.skeleton[_ngcontent-%COMP%]   .lines[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:8px}.skeleton[_ngcontent-%COMP%]   .line[_ngcontent-%COMP%]{height:10px;border-radius:999px;background:linear-gradient(90deg,#eef1ff,#f5f0ff,#eef1ff);background-size:200% 100%;animation:_ngcontent-%COMP%_shimmer 1.3s linear infinite}.skeleton[_ngcontent-%COMP%]   .line.short[_ngcontent-%COMP%]{width:60%}@keyframes _ngcontent-%COMP%_shimmer{0%{background-position:200% 0}to{background-position:-200% 0}}.state[_ngcontent-%COMP%]{margin-top:18px;font-size:.9rem;color:#4b5563}.state.error[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;background:#fef2f2;color:#b91c1c;border:1px solid rgba(248,113,113,.5)}.card[_ngcontent-%COMP%]{margin-top:18px;padding:16px 16px 14px;border-radius:20px;background:radial-gradient(circle at top left,#fdf6ff 0,#fff 40%);border:1px solid rgba(148,163,184,.15)}.card-main[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.avatar[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:18px;background:linear-gradient(145deg,#4f46e5,#a855f7);display:grid;place-items:center;font-size:1.6rem;color:#fff;box-shadow:0 18px 35px #5850ec59,0 0 0 1px #ffffffb3}.data[_ngcontent-%COMP%]{flex:1;display:grid;gap:6px}.label[_ngcontent-%COMP%]{display:block;font-size:.7rem;text-transform:uppercase;letter-spacing:.06em;color:#9ca3af;margin-bottom:1px}.alumno[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .tutor[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem;color:#111827}.correo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:last-child{font-size:.9rem;color:#374151}.card-actions[_ngcontent-%COMP%]{margin-top:14px;display:flex;flex-direction:column;gap:6px}.btn-chat[_ngcontent-%COMP%]{border:none;cursor:pointer;border-radius:999px;padding:10px 18px;font-size:.95rem;font-weight:600;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;box-shadow:0 16px 30px #4f46e559,0 0 0 1px #ffffffb3;transition:transform .12s ease,box-shadow .12s ease,filter .12s ease}.btn-chat[_ngcontent-%COMP%]:hover{transform:translateY(-1px);filter:brightness(1.05);box-shadow:0 20px 38px #4f46e573,0 0 0 1px #ffffffd9}.btn-chat[_ngcontent-%COMP%]:active{transform:translateY(0);box-shadow:0 10px 20px #4f46e559,0 0 0 1px #fffc}.hint[_ngcontent-%COMP%]{font-size:.8rem;color:#6b7280}.panel[_ngcontent-%COMP%]{align-self:stretch;background:#fff;border-radius:22px;padding:16px 16px 12px;box-shadow:0 22px 55px #0f172a1f,0 2px 10px #0f172a0d;display:flex;flex-direction:column;min-height:340px}@media (max-width: 1024px){.panel[_ngcontent-%COMP%]{min-height:420px}}.panel-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:4px 4px 10px;border-bottom:1px dashed rgba(148,163,184,.45)}.panel-head[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:.98rem;color:#111827}.btn-cerrar[_ngcontent-%COMP%]{border:none;cursor:pointer;width:26px;height:26px;border-radius:999px;font-size:.9rem;display:grid;place-items:center;background:#fee2e2;color:#b91c1c;transition:background .12s ease,transform .12s ease}.btn-cerrar[_ngcontent-%COMP%]:hover{background:#fecaca;transform:scale(1.03)}.btn-cerrar[_ngcontent-%COMP%]:active{transform:scale(.98)}.panel[_ngcontent-%COMP%]   app-chat-panel[_ngcontent-%COMP%]{display:block;margin-top:6px;height:calc(100% - 40px)}"]})};export{T as PadresComponent};
