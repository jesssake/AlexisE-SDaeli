<!-- C:\Codigos\HTml\gestion-educativa\frontend\src\app\features\Estudiantes\asistencia\asistencia.component.html -->
<div class="asistencia-estudiante-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <h1>📅 Mi Asistencia</h1>
      <div class="breadcrumb">Estudiante / Asistencia</div>
    </div>
    
    <div class="header-right">
      <div class="estudiante-info">
        <div class="avatar">
          <span class="avatar-icon">👨‍🎓</span>
        </div>
        <div class="info">
          <div class="nombre">{{ estudianteNombre }}</div>
          <div class="tutor">Tutor: {{ tutorNombre }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros y Controles -->
  <div class="controles-container" *ngIf="estudianteId">
    <div class="controles-superiores">
      <div class="filtros">
        <div class="filtro-group">
          <label for="mes">Mes:</label>
          <select id="mes" [(ngModel)]="mesSeleccionado" (change)="onMesChange()" [disabled]="cargando">
            <option *ngFor="let mes of meses" [value]="mes.numero">{{ mes.nombre }}</option>
          </select>
        </div>
        
        <div class="filtro-group">
          <label for="anio">Año:</label>  <!-- Cambiado de 'año' a 'anio' -->
          <select id="anio" [(ngModel)]="anioSeleccionado" (change)="onAnioChange()" [disabled]="cargando">
            <option *ngFor="let anio of anios" [value]="anio">{{ anio }}</option>  <!-- Cambiado 'años' por 'anios' -->
          </select>
        </div>
        
        <div class="filtro-group">
          <label for="limite">Mostrar:</label>
          <select id="limite" [(ngModel)]="limiteRegistros" (change)="onLimiteChange()" [disabled]="cargando">
            <option *ngFor="let limite of limites" [value]="limite">{{ limite }} registros</option>
          </select>
        </div>
      </div>
      
      <div class="acciones">
        <button class="btn btn-primary" (click)="cargarAsistencia()" [disabled]="cargando">
          <span *ngIf="!cargando">🔄 Actualizar</span>
          <span *ngIf="cargando">⏳ Cargando...</span>
        </button>
        
        <button class="btn btn-secondary" (click)="cargarAsistenciaHoy()" [disabled]="cargando">
          📅 Hoy
        </button>
        
        <button class="btn btn-success" (click)="limpiarFiltros()" [disabled]="cargando">
          🧹 Limpiar
        </button>
      </div>
    </div>
    
    <div class="controles-inferiores">
      <div class="exportar">
        <button class="btn btn-exportar" (click)="descargarReporte('pdf')">
          📄 PDF
        </button>
        <button class="btn btn-exportar" (click)="descargarReporte('excel')">
          📊 Excel
        </button>
        <button class="btn btn-exportar" (click)="descargarReporte('json')">
          🔧 JSON
        </button>
      </div>
      
      <button class="btn btn-debug" (click)="probarConexion()">
        🔍 Probar Conexión
      </button>
    </div>
  </div>

  <!-- Mensajes de estado -->
  <div class="mensajes">
    <div class="error-message" *ngIf="error">
      <span class="icon">⚠️</span>
      <span>{{ error }}</span>
    </div>
    
    <div class="success-message" *ngIf="mensajeExito">
      <span class="icon">✅</span>
      <span>{{ mensajeExito }}</span>
    </div>
  </div>

  <!-- Estadísticas Principales -->
  <div class="estadisticas-principales" *ngIf="estudianteId && !cargando && !error">
    <div class="tarjeta-estadistica total">
      <div class="icono">📊</div>
      <div class="contenido">
        <div class="valor">{{ estadisticas.generales.total_dias }}</div>
        <div class="label">Total de Días</div>
      </div>
    </div>
    
    <div class="tarjeta-estadistica presente">
      <div class="icono">✅</div>
      <div class="contenido">
        <div class="valor">{{ estadisticas.generales.presentes }}</div>
        <div class="label">Presentes</div>
      </div>
    </div>
    
    <div class="tarjeta-estadistica ausente">
      <div class="icono">❌</div>
      <div class="contenido">
        <div class="valor">{{ estadisticas.generales.ausentes }}</div>
        <div class="label">Ausentes</div>
      </div>
    </div>
    
    <div class="tarjeta-estadistica justificado">
      <div class="icono">⚠️</div>
      <div class="contenido">
        <div class="valor">{{ estadisticas.generales.justificados }}</div>
        <div class="label">Justificados</div>
      </div>
    </div>
    
    <div class="tarjeta-estadistica porcentaje" [class]="getPorcentajeColor(estadisticas.generales.porcentaje_asistencia)">
      <div class="icono">📈</div>
      <div class="contenido">
        <div class="valor">{{ estadisticas.generales.porcentaje_asistencia }}%</div>
        <div class="label">Porcentaje</div>
      </div>
    </div>
  </div>

  <!-- Última Asistencia -->
  <div class="ultima-asistencia" *ngIf="ultimaAsistencia && !cargando">
    <div class="titulo-seccion">
      <h3>📝 Última Asistencia Registrada</h3>
    </div>
    <div class="tarjeta-ultima">
      <div class="fecha">
        <span class="icono">📅</span>
        <span>{{ formatearFecha(ultimaAsistencia.fecha) }}</span>
      </div>
      <div class="estado" [class]="getEstadoClass(ultimaAsistencia.estado)">
        <span class="icono">{{ getEstadoIcon(ultimaAsistencia.estado) }}</span>
        <span>{{ getEstadoText(ultimaAsistencia.estado) }}</span>
      </div>
      <div class="comentario" *ngIf="ultimaAsistencia.comentario_maestro">
        <span class="icono">💬</span>
        <span>{{ ultimaAsistencia.comentario_maestro }}</span>
      </div>
    </div>
  </div>

  <!-- Resumen Mensual -->
  <div class="resumen-mensual" *ngIf="resumenMensual.length > 0 && !cargando">
    <div class="titulo-seccion">
      <h3>📈 Resumen por Mes ({{ anioSeleccionado }})</h3>  <!-- Cambiado aquí -->
    </div>
    <div class="meses-grid">
      <div *ngFor="let mes of resumenMensual" class="mes-card" [class]="getPorcentajeColor(mes.porcentaje)">
        <div class="mes-header">
          <span class="mes-nombre">{{ mes.mes_nombre }}</span>
          <span class="mes-porcentaje">{{ mes.porcentaje }}%</span>
        </div>
        <div class="mes-detalle">
          <div class="detalle-item">
            <span class="icono">✅</span>
            <span class="valor">{{ mes.presentes }}</span>
          </div>
          <div class="detalle-item">
            <span class="icono">❌</span>
            <span class="valor">{{ mes.ausentes }}</span>
          </div>
          <div class="detalle-item">
            <span class="icono">⚠️</span>
            <span class="valor">{{ mes.justificados }}</span>
          </div>
        </div>
        <div class="mes-total">
          <span class="label">Total:</span>
          <span class="valor">{{ mes.total_dias }} días</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Lista de Asistencias -->
  <div class="lista-asistencias" *ngIf="estudianteId && !cargando && !error">
    <div class="titulo-seccion">
      <h3>📋 Historial de Asistencias</h3>
      <div class="contador">
        Mostrando {{ asistencias.length }} registros
      </div>
    </div>
    
    <div *ngIf="asistencias.length === 0" class="sin-registros">
      <div class="icono">📭</div>
      <div class="mensaje">No hay registros de asistencia para el período seleccionado.</div>
      <div class="sugerencia">Intenta cambiar los filtros o seleccionar otro mes/año.</div>
    </div>
    
    <div class="tabla-container" *ngIf="asistencias.length > 0">
      <table class="tabla-asistencias">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Día</th>
            <th>Hora</th>
            <th>Estado</th>
            <th>Maestro</th>
            <th>Comentario</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let asistencia of asistencias" [class]="getEstadoClass(asistencia.estado)">
            <td class="fecha">
              <div class="fecha-completa">{{ asistencia.fecha_formateada }}</div>
              <div class="anio-mes">{{ asistencia.anio }}-{{ asistencia.mes_numero.toString().padStart(2, '0') }}</div>  <!-- Cambiado aquí -->
            </td>
            <td class="dia">
              <div class="dia-semana">{{ asistencia.dia_semana }}</div>
              <div class="dia-numero">Día {{ asistencia.dia }}</div>
            </td>
            <td class="hora">
              <span class="icono-hora">🕐</span>
              {{ asistencia.hora_clase }}
            </td>
            <td class="estado">
              <span class="estado-icono">{{ getEstadoIcon(asistencia.estado) }}</span>
              <span class="estado-texto">{{ getEstadoText(asistencia.estado) }}</span>
            </td>
            <td class="maestro">
              <span class="icono-maestro">👨‍🏫</span>
              {{ asistencia.maestro_nombre || 'No asignado' }}
            </td>
            <td class="comentario">
              <div class="comentario-texto" *ngIf="asistencia.comentario_maestro">
                {{ asistencia.comentario_maestro }}
              </div>
              <div class="sin-comentario" *ngIf="!asistencia.comentario_maestro">
                Sin comentarios
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="paginacion" *ngIf="asistencias.length > 10">
      <div class="info-paginacion">
        Mostrando {{ asistencias.length }} de {{ estadisticas.generales.total_dias }} registros totales
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="cargando">
    <div class="loading-spinner"></div>
    <div class="loading-text">Cargando tu asistencia...</div>
    <div class="loading-subtext">Esto puede tomar unos segundos</div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="info-sistema">
      <span class="icono">⚙️</span>
      <span>Sistema de Asistencia - Versión 1.0</span>
    </div>
    <div class="info-fecha">
      <span class="icono">📅</span>
      <span>Actualizado: {{ fechaActual }}</span>
    </div>
  </div>
</div>