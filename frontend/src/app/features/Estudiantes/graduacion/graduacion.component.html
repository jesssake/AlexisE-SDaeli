<!-- C:\Codigos\HTml\gestion-educativa\frontend\src\app\features\Estudiantes\graduacion\graduacion.component.html -->
<div class="graduacion-estudiante-wrapper" [class.loading]="cargando">
  <!-- CABECERA -->
  <div class="header">
    <div class="header-info">
      <h1>üéì Mis Certificados de Excelencia</h1>
      <p class="subtitle">Consulta y descarga tus certificados acad√©micos y cartas de cierre de ciclo</p>
    </div>
    
    <div class="header-actions">
      <button class="btn btn-refresh" (click)="recargarDatos()" [disabled]="cargando">
        üîÑ {{ cargando ? 'Cargando...' : 'Recargar' }}
      </button>
      <button class="btn btn-test" (click)="testBackend()" [disabled]="cargando">
        üß™ Test Backend
      </button>
    </div>
  </div>

  <!-- MENSAJES DE ERROR/INFORMACI√ìN -->
  <div *ngIf="error" class="error-message">
    ‚ö†Ô∏è {{ error }}
  </div>

  <!-- ESTAD√çSTICAS PERSONALES -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-content">
        <p class="label">TOTAL DE CERTIFICADOS</p>
        <p class="value">{{ stats.total }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <p class="label">ENVIADOS</p>
        <p class="value">{{ stats.enviados }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-content">
        <p class="label">PENDIENTES</p>
        <p class="value">{{ stats.pendientes }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">üìà</div>
      <div class="stat-content">
        <p class="label">PROMEDIO GENERAL</p>
        <p class="value">{{ stats.promedio_general }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚¨ÜÔ∏è</div>
      <div class="stat-content">
        <p class="label">PROMEDIO M√ÅXIMO</p>
        <p class="value">{{ stats.promedio_maximo }}</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">‚¨áÔ∏è</div>
      <div class="stat-content">
        <p class="label">PROMEDIO M√çNIMO</p>
        <p class="value">{{ stats.promedio_minimo }}</p>
      </div>
    </div>
  </div>

  <!-- INFORMACI√ìN DEL ESTUDIANTE -->
  <div *ngIf="resumen?.estudiante" class="info-estudiante">
    <h3>üë§ Informaci√≥n del Estudiante</h3>
    <div class="info-grid">
      <div class="info-item">
        <span class="info-label">Nombre:</span>
        <span class="info-value">{{ resumen?.estudiante?.nombre }}</span> <!-- ‚úÖ CORREGIDO -->
      </div>
      <div class="info-item">
        <span class="info-label">Tutor:</span>
        <span class="info-value">{{ resumen?.estudiante?.tutor }}</span> <!-- ‚úÖ CORREGIDO -->
      </div>
      <div class="info-item">
        <span class="info-label">Grado:</span>
        <span class="info-value">{{ resumen?.estudiante?.grado }}</span> <!-- ‚úÖ CORREGIDO -->
      </div>
      <div class="info-item">
        <span class="info-label">Email tutor:</span>
        <span class="info-value">{{ resumen?.estudiante?.email }}</span> <!-- ‚úÖ CORREGIDO -->
      </div>
    </div>
  </div>

  <!-- FILTROS -->
  <div class="filtros-section" *ngIf="certificados.length > 0">
    <h3>üîç Filtrar certificados</h3>
    
    <div class="filtros-grid">
      <div class="filtro-item">
        <label for="filtro-estado">Estado:</label>
        <select id="filtro-estado" [(ngModel)]="filtros.estado" (change)="aplicarFiltros()">
          <option value="todos">Todos los estados</option>
          <option value="enviado">‚úÖ Enviados</option>
          <option value="pendiente">‚è≥ Pendientes</option>
        </select>
      </div>

      <div class="filtro-item">
        <label for="filtro-ciclo">Ciclo escolar:</label>
        <select id="filtro-ciclo" [(ngModel)]="filtros.ciclo" (change)="aplicarFiltros()">
          <option value="todos">Todos los ciclos</option>
          <option *ngFor="let ciclo of ciclosUnicos" [value]="ciclo">
            {{ ciclo }}
          </option>
        </select>
      </div>

      <div class="filtro-item">
        <button class="btn btn-clear" (click)="limpiarFiltros()">
          üßπ Limpiar filtros
        </button>
      </div>
    </div>
  </div>

  <!-- TABLA DE CERTIFICADOS -->
  <div class="tabla-section">
    <div class="tabla-header">
      <h3>üìú Mis Certificados ({{ certificados.length }})</h3>
      <div class="tabla-info">
        <span *ngIf="certificados.length > 0">
          Disponibles para descarga: {{ resumen?.certificados_disponibles_descarga || 0 }}
        </span>
      </div>
    </div>

    <!-- INDICADOR DE CARGA -->
    <div *ngIf="cargando" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando certificados...</p>
    </div>

    <!-- MENSAJE SIN CERTIFICADOS -->
    <div *ngIf="!cargando && certificados.length === 0" class="empty-state">
      <div class="empty-icon">üìÑ</div>
      <h3>No tienes certificados a√∫n</h3>
      <p *ngIf="resumen?.estudiante?.nombre"> <!-- ‚úÖ CORREGIDO -->
        Hola {{resumen?.estudiante?.nombre}}, a√∫n no has recibido certificados de excelencia. <!-- ‚úÖ CORREGIDO -->
      </p>
      <p>Los certificados aparecer√°n aqu√≠ cuando tu maestro los genere y env√≠e.</p>
      <p class="empty-note"><small>Si crees que deber√≠as tener certificados, contacta a tu maestro.</small></p>
    </div>

    <!-- TABLA DE CERTIFICADOS -->
    <div *ngIf="!cargando && certificados.length > 0" class="tabla-container">
      <table class="certificados-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Ciclo escolar</th>
            <th>Promedio</th>
            <th>Maestro</th>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        
        <tbody>
          <tr *ngFor="let certificado of certificados" class="certificado-row">
            <td class="certificado-id">#{{ certificado.id }}</td>
            <td class="certificado-ciclo">{{ certificado.ciclo }}</td>
            <td>
              <span class="promedio-badge" [style.background-color]="getColorPromedio(certificado.promedio)">
                {{ certificado.promedio | number:'1.1-2' }}
              </span>
            </td>
            <td class="certificado-maestro">{{ certificado.maestro_firma }}</td>
            <td class="certificado-fecha">
              {{ certificado.fecha_formateada || fechaBonita(certificado.fecha_creacion) }}
            </td>
            <td>
              <span class="estado-badge" [style.background-color]="getColorEstado(certificado.estado)">
                {{ estadoTexto(certificado.estado) }}
              </span>
            </td>
            <td class="acciones-cell">
              <div class="acciones-group">
                <button class="btn-action btn-download" 
                        (click)="descargarCertificado(certificado.id)" 
                        [disabled]="certificado.estado !== 'enviado'"
                        [title]="certificado.estado === 'enviado' ? 'Descargar certificado' : 'No disponible para descarga'">
                  ‚¨áÔ∏è Descargar
                </button>
                <button class="btn-action btn-view" (click)="verDetalles(certificado)">
                  üëÅÔ∏è Ver
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- INFORMACI√ìN ADICIONAL -->
  <div class="info-extra" *ngIf="certificados.length > 0">
    <h3>üìã Informaci√≥n importante sobre los certificados</h3>
    <div class="info-list">
      <div class="info-item">
        <span class="info-icon">‚úÖ</span>
        <div class="info-text">
          <strong>Certificados enviados:</strong> Puedes descargarlos haciendo clic en el bot√≥n "Descargar"
        </div>
      </div>
      <div class="info-item">
        <span class="info-icon">‚è≥</span>
        <div class="info-text">
          <strong>Certificados pendientes:</strong> Tu maestro a√∫n no los ha enviado. Aparecer√°n cuando est√©n listos
        </div>
      </div>
      <div class="info-item">
        <span class="info-icon">üìß</span>
        <div class="info-text">
          <strong>Problemas con descargas:</strong> Contacta a tu maestro si no puedes descargar un certificado que deber√≠a estar disponible
        </div>
      </div>
      <div class="info-item">
        <span class="info-icon">üîÑ</span>
        <div class="info-text">
          <strong>Actualizaciones:</strong> Los certificados nuevos aparecer√°n autom√°ticamente cuando el maestro los genere
        </div>
      </div>
    </div>
  </div>

  <!-- DEBUG (solo en desarrollo) -->
  <div *ngIf="false" class="debug-section">
    <button class="btn btn-debug" (click)="verificarDatos()">üîç Verificar datos</button>
    <div class="debug-info">
      <p><strong>ID Estudiante:</strong> {{ estudianteId }}</p>
      <p><strong>Ciclos disponibles:</strong> {{ ciclosUnicos.length }}</p>
    </div>
  </div>
</div>