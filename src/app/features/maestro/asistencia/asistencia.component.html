<div class="asistencia-page">
  <header class="top-bar">
    <div class="left">
      <h2>ðŸ“‹ Pase de lista</h2>
      <p class="sub">
        Marca asistencia, faltas y justificaciones. TambiÃ©n puedes dejar
        comentarios individuales.
      </p>
    </div>

    <div class="right filtros">
      <label class="filtro-field">
        <span>Fecha</span>
        <input
          type="date"
          [(ngModel)]="fecha"
          (change)="cargarRegistros()"
        />
      </label>

      <label class="filtro-field">
        <span>Hora</span>
        <input
          type="time"
          [(ngModel)]="horaClase"
          (change)="cargarRegistros()"
        />
      </label>

      <button class="btn btn-light" (click)="cargarRegistros()" [disabled]="cargando">
        â†» Cargar
      </button>
    </div>
  </header>

  <!-- Mensajes de estado -->
  <div class="estado" *ngIf="cargando">Cargando alumnos...</div>
  <div class="estado error" *ngIf="!cargando && errorMsg">{{ errorMsg }}</div>
  <div class="estado ok" *ngIf="!cargando && okMsg">{{ okMsg }}</div>

  <!-- Si no hay registros -->
  <div class="estado vacio" *ngIf="!cargando && !errorMsg && registros.length === 0">
    No hay alumnos para esta fecha/hora.
  </div>

  <!-- Tabla -->
  <div class="tabla-wrapper" *ngIf="!cargando && !errorMsg && registros.length > 0">
    <table class="tabla-asistencia">
      <thead>
        <tr>
          <th>#</th>
          <th>Alumno</th>
          <th>Edad</th>
          <th>Estado</th>
          <th>Comentario</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of registros; let i = index">
          <td>{{ i + 1 }}</td>

          <td class="alumno-info">
            <div class="nombre">{{ r.nombre }}</div>
            <div class="id">ID: {{ r.estudiante_id }}</div>
          </td>

          <td class="edad">
            <ng-container *ngIf="r.edad !== null && r.edad !== undefined; else noedad">
              {{ r.edad }} aÃ±os
            </ng-container>
            <ng-template #noedad>-</ng-template>
          </td>

          <td class="estado-checks">
            <label class="estado-option">
              <input
                type="radio"
                name="estado-{{ r.estudiante_id }}"
                [checked]="r.estado === 'PRESENTE'"
                (change)="marcarEstado(r, 'PRESENTE')"
              />
              <span class="badge presente">Presente</span>
            </label>

            <label class="estado-option">
              <input
                type="radio"
                name="estado-{{ r.estudiante_id }}"
                [checked]="r.estado === 'AUSENTE'"
                (change)="marcarEstado(r, 'AUSENTE')"
              />
              <span class="badge ausente">Ausente</span>
            </label>

            <label class="estado-option">
              <input
                type="radio"
                name="estado-{{ r.estudiante_id }}"
                [checked]="r.estado === 'JUSTIFICADO'"
                (change)="marcarEstado(r, 'JUSTIFICADO')"
              />
              <span class="badge justificado">JustificÃ³</span>
            </label>
          </td>

          <td class="comentario">
            <textarea
              [(ngModel)]="r.comentario_maestro"
              placeholder="Comentario (opcional)"
              rows="2"
            ></textarea>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Guardar -->
  <footer class="acciones-guardar" *ngIf="registros.length > 0">
    <button
      class="btn btn-save"
      (click)="guardarAsistencia()"
      [disabled]="guardando"
    >
      ðŸ’¾ Guardar asistencia
    </button>
  </footer>
</div>
