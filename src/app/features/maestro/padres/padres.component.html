<div class="layout" role="region" aria-label="Padres y Chat">
  <div class="lista">
    <header class="top">
      <h2>Padres / Tutores</h2>

      <div class="actions">
        <input
          type="search"
          class="input"
          placeholder="Buscar alumno/tutor‚Ä¶"
          [ngModel]="filtro()"
          (ngModelChange)="filtro.set($event)"
          (keyup.enter)="aplicarFiltro()"
          aria-label="Buscar en la tabla"
        />

        <select
          class="input"
          [ngModel]="ordenCampo()"
          (ngModelChange)="ordenCampo.set($any($event))"
          aria-label="Ordenar por"
        >
          <option value="alumno">Alumno</option>
          <option value="tutor">Tutor</option>
          <option value="correo">Correo</option>
        </select>

        <button class="btn" (click)="toggleOrdenDir()" [attr.aria-pressed]="ordenAsc()">
          {{ ordenAsc() ? '‚Üë ASC' : '‚Üì DESC' }}
        </button>

        <button
          class="btn-refresh"
          (click)="cargarPadres()"
          [disabled]="cargando()"
          title="Actualizar lista"
        >
          ‚Üª
        </button>
      </div>
    </header>

    <div *ngIf="cargando()" class="skeleton">
      <div class="row" *ngFor="let i of dummyRows">
        <span class="sk a"></span><span class="sk b"></span><span class="sk c"></span><span class="sk d"></span>
      </div>
    </div>

    <div *ngIf="error()" class="state error">
      {{ error() }}
      <button class="btn" (click)="cargarPadres()">Reintentar</button>
    </div>

    <table class="tabla" *ngIf="!cargando() && !error()">
      <thead>
        <tr>
          <th>Alumno</th>
          <th>Tutor</th>
          <th>Correo</th>
          <th style="width:120px">Chat</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of listaFiltradaOrdenada(); trackBy: trackByAlumno">
          <td>{{ p.alumno_nombre }}</td>
          <td>{{ p.tutor_nombre || '‚Äî' }}</td>
          <td>{{ p.tutor_correo || '‚Äî' }}</td>
          <td>
            <button
              class="btn-chat"
              (click)="abrirChatInline(p)"
              [attr.aria-label]="'Abrir chat con ' + (p.tutor_nombre || 'tutor') + ' de ' + p.alumno_nombre"
            >
              üí¨ Abrir
            </button>
          </td>
        </tr>
        <tr *ngIf="listaFiltradaOrdenada().length === 0">
          <td colspan="4" class="state">Sin resultados para ‚Äú{{ filtro() }}‚Äù.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Panel lateral del chat (MISMA VISTA) -->
  <aside class="panel" *ngIf="chatAbierto()" role="dialog" aria-modal="true" [attr.aria-label]="selTitulo()">
    <div class="panel-head">
      <strong>{{ selTitulo() }}</strong>
      <button class="btn-cerrar" (click)="cerrarChatInline()" aria-label="Cerrar chat">‚úï</button>
    </div>

    <app-chat-panel
      *ngIf="selAlumnoId() !== null"
      [alumnoId]="selAlumnoId()!"
      [tutorId]="selTutorId()"
      [titulo]="selTitulo()"
    ></app-chat-panel>
  </aside>
</div>
