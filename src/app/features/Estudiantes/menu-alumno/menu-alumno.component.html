﻿<div class="layout">
  <!-- PARTÍCULAS DE FONDO -->
  <div class="particles" #particlesContainer></div>
  
  <!-- BARRA LATERAL -->
  <aside class="sidebar" [class.colapsada]="sidebarColapsada" [class.mobile]="isMobile">
    <div class="brand" (click)="toggleSidebar()" role="button" tabindex="0" (keyup.enter)="toggleSidebar()">
      <div class="mascota" aria-hidden="true">🚀</div>
      <div class="marca">
        <strong>EduPlatform Pro</strong>
        <small>Experiencia Premium</small>
      </div>
      <button class="toggle" type="button" [attr.aria-label]="sidebarColapsada ? 'Expandir menú' : 'Contraer menú'">
        {{ sidebarColapsada ? '»' : '«' }}
      </button>
    </div>

    <nav class="nav" aria-label="Navegación principal">
      <a *ngFor="let item of nav"
         class="nav-item"
         [routerLink]="item.link"
         routerLinkActive="active"
         [attr.data-tooltip]="sidebarColapsada ? item.titulo : null"
         [attr.aria-label]="item.titulo"
         (click)="onItemClick($event)">
        <span class="ink" #ink></span>
        <span class="nav-icon" aria-hidden="true">{{ item.icono }}</span>
        <span class="nav-text">
          <span class="nav-title">{{ item.titulo }}</span>
          <small class="nav-desc">{{ item.desc }}</small>
        </span>
        <span class="nav-badge" *ngIf="item.key === 'tareas' && getPendingTasks() > 0">
          {{ getPendingTasks() }}
        </span>
      </a>
    </nav>

    <div class="footer">
      <button class="btn salir" (click)="cerrarSesion()" aria-label="Cerrar sesión">
        <span class="ico">⚡</span>
        <span class="btn-text">Cerrar Sesión</span>
      </button>
    </div>
  </aside>

  <!-- OVERLAY PARA MÓVIL -->
  <div class="sidebar-overlay" 
       [class.active]="sidebarColapsada && isMobile" 
       (click)="toggleSidebar()">
  </div>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="content" [class.menu-abierto]="sidebarColapsada" role="main">
    <!-- Tarjeta de Bienvenida SOLO CON EL TÍTULO -->
    <article class="bienvenida" *ngIf="datosAlumno && !cargando">
      <header class="encabezado">
        <div class="avatar" role="img" aria-label="Avatar del estudiante">
          <span>{{ getInitials(datosAlumno.alumno_nombre) }}</span>
        </div>
        <div class="titulos">
          <h1>¡Bienvenido, {{ datosAlumno.alumno_nombre }}!</h1>
          <p class="sub">Tu centro de excelencia académica y desarrollo personal</p>
        </div>
      </header>
      <!-- 👇 aquí estaba el <ul class="datos">, ya lo quité -->
    </article>

    <!-- ESTADOS DE CARGA Y ERROR -->
    <div *ngIf="cargando" class="alert loading" role="status" aria-live="polite">
      <span class="ico">⏳</span>
      <span><strong>Cargando información...</strong> Preparando tu experiencia educativa</span>
    </div>
    
    <div *ngIf="error && !cargando" class="alert error" role="alert" aria-live="assertive">
      <span class="ico">⚠️</span>
      <span><strong>Atención:</strong> {{ error }}</span>
    </div>

    <!-- MÓDULO (Tareas, Reportes, etc.) -->
    <section class="modulo">
      <router-outlet></router-outlet>
    </section>
  </main>
</div>
